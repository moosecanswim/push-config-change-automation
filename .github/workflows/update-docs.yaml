
name: Create PR to update helm versions

on:
  push:
    branches:
      - actions

jobs:
  create_pr:
    name: Create PR to update book.json with new values
    runs-on: ubuntu-latest
    steps:

      - name: Is jq installed
        run: |
          jq --version

      - name: Export chart versions
        run: |
          export FABRIC_VERSION=$(cat chart-versions.json | jq -r '.fabric')
          export SENSE_VERSION=$(cat chart-versions.json | jq -r '.sense')
          export EDGE_VERSION=$(cat chart-versions.json | jq -r '.edge')
          export SECRETS_VERSION=$(cat chart-versions.json | jq -r '.secrets')
          export SPIRE_AGENT_VERSION=$(cat chart-versions.json | jq -r '.spire_agent')
          export SPIRE_SERVER_VERSION=$(cat chart-versions.json | jq -r '.spire_server')

      - name: Pull in File to update
        run: |
          # setup git details
          export GITHUB_USER=moosecanswim
          git config --global user.email "62956126+vwadbot@users.noreply.github.com"
          git config --global user.name $GITHUB_USER
          echo $BRANCH_STAMP

          git clone -o upstream https://github.com/moosecanswim/test-config-change-automation.git
          
          cd test-config-change-automation
          
          echo "Printing exported chart versions"
          echo "FABRIC_VERSION: $FABRIC_VERSION"
          echo "SENSE_VERSION: $SENSE_VERSION"
          echo "EDGE_VERSION: $EDGE_VERSION"
          echo "SECRETS_VERSION: $SECRETS_VERSION"
          echo "SPIRE_AGENT_VERSION: $SPIRE_AGENT_VERSION"
          echo "SPIRE_SERVER_VERSION: $SPIRE_SERVER_VERSION"


          ls -al

          cat book.json
          
          # cd target
          # # do a sed to update shit in target
          # git checkout -b increment-charts
          # git add target
          # git commit -m "Automatic publish from learn-go"
          # git push --set-upstream origin increment-charts